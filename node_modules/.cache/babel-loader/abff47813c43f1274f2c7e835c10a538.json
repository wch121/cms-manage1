{"ast":null,"code":"var _jsxFileName = \"D:\\\\vs code\\\\project\\\\aka\\\\cms\\\\cms-manage\\\\cms-manage1\\\\src\\\\pages\\\\Edit.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { PageHeader, Button, Modal, Form, Input, message } from 'antd';\nimport moment from 'moment';\nimport E from 'wangeditor';\nimport { ArticleAddApi, ArticleSearchApi, ArticleUpdateApi } from '../request/api';\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet editor = null;\nexport default function Edit() {\n  _s();\n  const [content, setContent] = useState('');\n  const location = useLocation();\n  const [title, setTitle] = useState('');\n  const [subTitle, setSubTitle] = useState('');\n  const [isModalVisible, setIsModalVisible] = useState(false);\n  const navigate = useNavigate();\n  const [form] = Form.useForm();\n  const params = useParams();\n\n  // 处理请求数据\n  const dealData = (errCode, msg) => {\n    setIsModalVisible(false); // 关闭对话框\n    if (errCode === 0) {\n      message.success(msg);\n      setTimeout(() => {\n        // 跳回list页面\n        navigate('/listlist');\n      }, 1500);\n    } else {\n      message.error(msg);\n    }\n  };\n\n  // 对话框点击了提交\n  const handleOk = () => {\n    form.validateFields() // validate校验   field字段\n    .then(values => {\n      // form.resetFields();   // reset重置\n      let {\n        title,\n        subTitle\n      } = values;\n      // 地址栏有id代表现在想要更新一篇文章\n      if (params.id) {\n        // 更新文章的请求\n        ArticleUpdateApi({\n          title,\n          subTitle,\n          content,\n          id: params.id\n        }).then(res => dealData(res.errCode, res.message));\n      } else {\n        // 添加文章的请求\n        ArticleAddApi({\n          title,\n          subTitle,\n          content\n        }).then(res => dealData(res.errCode, res.message));\n      }\n    }).catch(() => false);\n  };\n\n  // 模拟componentDidMount\n  useEffect(() => {\n    editor = new E('#div1');\n    editor.config.onchange = newHtml => {\n      setContent(newHtml);\n    };\n    editor.create();\n\n    // 根据地址栏id做请求\n    if (params.id) {\n      ArticleSearchApi({\n        id: params.id\n      }).then(res => {\n        if (res.errCode === 0) {\n          editor.txt.html(res.data.content); // 重新设置编辑器内容\n          setTitle(res.data.title);\n          setSubTitle(res.data.subTitle);\n        }\n      });\n    }\n    return () => {\n      // 组件销毁时销毁编辑器  注：class写法需要在componentWillUnmount中调用\n      editor.destroy();\n    };\n  }, [location.pathname]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(PageHeader, {\n      ghost: false,\n      onBack: params.id ? () => window.history.back() : null,\n      title: \"\\u6587\\u7AE0\\u7F16\\u8F91\",\n      subTitle: \"当前日期：\" + moment(new Date()).format(\"YYYY-MM-DD\"),\n      extra: /*#__PURE__*/_jsxDEV(Button, {\n        type: \"primary\",\n        onClick: () => setIsModalVisible(true),\n        children: \"\\u63D0\\u4EA4\\u6587\\u7AE0\"\n      }, \"1\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 16\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"div1\",\n      style: {\n        padding: '0 20px 20px',\n        background: '#fff'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      zIndex: 99999,\n      title: \"\\u586B\\u5199\\u6587\\u7AE0\\u6807\\u9898\",\n      visible: isModalVisible,\n      onOk: handleOk,\n      onCancel: () => setIsModalVisible(false),\n      okText: \"\\u63D0\\u4EA4\",\n      cancelText: \"\\u53D6\\u6D88\",\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        form: form,\n        name: \"basic\",\n        labelCol: {\n          span: 3\n        },\n        wrapperCol: {\n          span: 21\n        },\n        autoComplete: \"off\",\n        initialValues: {\n          title,\n          subTitle\n        },\n        children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n          label: \"\\u6807\\u9898\",\n          name: \"title\",\n          rules: [{\n            required: true,\n            message: '请填写标题'\n          }],\n          children: /*#__PURE__*/_jsxDEV(Input, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n          label: \"\\u526F\\u6807\\u9898\",\n          name: \"subTitle\",\n          children: /*#__PURE__*/_jsxDEV(Input, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 5\n  }, this);\n}\n_s(Edit, \"QeFF4ebgjtDBlFxP10Nh66SiDZs=\", false, function () {\n  return [useLocation, useNavigate, Form.useForm, useParams];\n});\n_c = Edit;\nvar _c;\n$RefreshReg$(_c, \"Edit\");","map":{"version":3,"names":["React","useEffect","useState","PageHeader","Button","Modal","Form","Input","message","moment","E","ArticleAddApi","ArticleSearchApi","ArticleUpdateApi","useParams","useNavigate","useLocation","editor","Edit","content","setContent","location","title","setTitle","subTitle","setSubTitle","isModalVisible","setIsModalVisible","navigate","form","useForm","params","dealData","errCode","msg","success","setTimeout","error","handleOk","validateFields","then","values","id","res","catch","config","onchange","newHtml","create","txt","html","data","destroy","pathname","window","history","back","Date","format","padding","background","span","required"],"sources":["D:/vs code/project/aka/cms/cms-manage/cms-manage1/src/pages/Edit.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { PageHeader, Button, Modal, Form, Input, message } from 'antd';\nimport moment from 'moment'\nimport E from 'wangeditor'\nimport { ArticleAddApi, ArticleSearchApi, ArticleUpdateApi } from '../request/api'\nimport { useParams, useNavigate, useLocation } from 'react-router-dom'\n\nlet editor = null\n\nexport default function Edit() {\n  const [content, setContent] = useState('')\n  const location = useLocation()\n  const [title, setTitle] = useState('')\n  const [subTitle, setSubTitle] = useState('')\n  const [isModalVisible, setIsModalVisible] = useState(false);\n  const navigate = useNavigate()\n  const [form] = Form.useForm();\n  const params = useParams()\n\n  // 处理请求数据\n  const dealData = (errCode, msg) => {\n    setIsModalVisible(false); // 关闭对话框\n    if (errCode === 0) {\n      message.success(msg)\n      setTimeout(() => {\n        // 跳回list页面\n        navigate('/listlist')\n      }, 1500)\n    } else {\n      message.error(msg)\n    }\n  }\n\n  // 对话框点击了提交\n  const handleOk = () => {\n    form\n      .validateFields()    // validate校验   field字段\n      .then((values) => {\n        // form.resetFields();   // reset重置\n        let { title, subTitle } = values;\n        // 地址栏有id代表现在想要更新一篇文章\n        if (params.id) {\n          // 更新文章的请求\n          ArticleUpdateApi({ title, subTitle, content, id: params.id }).then(res => dealData(res.errCode, res.message))\n        } else {\n          // 添加文章的请求\n          ArticleAddApi({ title, subTitle, content }).then(res => dealData(res.errCode, res.message))\n        }\n      })\n      .catch(() => false);\n  };\n\n  // 模拟componentDidMount\n  useEffect(() => {\n    editor = new E('#div1')\n    editor.config.onchange = (newHtml) => {\n      setContent(newHtml)\n    }\n    editor.create()\n\n    // 根据地址栏id做请求\n    if (params.id) {\n      ArticleSearchApi({ id: params.id }).then(res => {\n        if (res.errCode === 0) {\n          editor.txt.html(res.data.content) // 重新设置编辑器内容\n          setTitle(res.data.title)\n          setSubTitle(res.data.subTitle)\n        }\n      })\n    }\n\n    return () => {\n      // 组件销毁时销毁编辑器  注：class写法需要在componentWillUnmount中调用\n      editor.destroy()\n    }\n  }, [location.pathname])\n\n  return (\n    <div>\n      <PageHeader\n        ghost={false}\n        onBack={params.id ? () => window.history.back() : null}\n        title=\"文章编辑\"\n        subTitle={\"当前日期：\" + moment(new Date()).format(\"YYYY-MM-DD\")}\n        extra={<Button key=\"1\" type=\"primary\" onClick={() => setIsModalVisible(true)}>提交文章</Button>}\n      ></PageHeader>\n      <div id=\"div1\" style={{ padding: '0 20px 20px', background: '#fff' }}></div>\n      <Modal zIndex={99999} title=\"填写文章标题\" visible={isModalVisible} onOk={handleOk} onCancel={() => setIsModalVisible(false)} okText=\"提交\" cancelText=\"取消\">\n        <Form\n          form={form}\n          name=\"basic\"\n          labelCol={{ span: 3 }}\n          wrapperCol={{ span: 21 }}\n          autoComplete=\"off\"\n          initialValues={{ title, subTitle }}\n        >\n          <Form.Item\n            label=\"标题\"\n            name=\"title\"\n            rules={[{ required: true, message: '请填写标题' }]}\n          >\n            <Input />\n          </Form.Item>\n\n          <Form.Item\n            label=\"副标题\"\n            name=\"subTitle\"\n          >\n            <Input />\n          </Form.Item>\n        </Form>\n      </Modal>\n    </div>\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}